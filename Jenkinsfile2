pipeline{
    agent any
    options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '1', numToKeepStr: '5')
}
    stages{
        stage('Git checkout'){
            steps{
             git branch: 'main', credentialsId: 'slave', url: 'https://github.com/veduruchandrashekar/reddy-app.git'
            }
        }
        stage('Maven build'){
            steps{
                sh 'mvn clean package'
            }
        }
        stage('Nexus atrefact uploader'){
            steps{
                  nexusArtifactUploader artifacts: [[artifactId: 'hr-api', classifier: '', file: 'target/hr-api.war', type: 'war']], 
                  credentialsId: 'admin', 
                  groupId: 'in.javahome', 
                  nexusUrl: '172.31.7.143:8081', 
                  nexusVersion: 'nexus3', 
                  protocol: 'http', 
                  repository: 'app_war_files', 
                  version: '1.1'  
            }
        }
     stage('Docker image build'){
           steps{
               sh 'docker build -t veduruchandrashekar/hr-api6 .'
           }
       }
        stage('Docker image push'){
            steps{
                withCredentials([usernamePassword(credentialsId: 'veduruchandrashekar', passwordVariable: 'password', usernameVariable: 'username')]) {
                sh 'docker login -u ${username} -p ${password}'
            }
               sh 'docker push veduruchandrashekar/hr-api6:latest'
            }
        }
       
       
    }
    post {
  success {
    echo "Deployment is success and app is deployed"
  }
}
}
